<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:common="using:VaultKeeper.AvaloniaApplication.Views.Common"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="using:VaultKeeper.AvaloniaApplication.Views.Settings"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:models="using:VaultKeeper.AvaloniaApplication.Abstractions.Models"
             xmlns:overlays="using:VaultKeeper.AvaloniaApplication.Views.Common.Overlays"
             xmlns:settings="using:VaultKeeper.Models.Settings"
             xmlns:vm="using:VaultKeeper.AvaloniaApplication.ViewModels.Settings"
             mc:Ignorable="d" d:DesignWidth="1920" d:DesignHeight="2000"
             x:Class="VaultKeeper.AvaloniaApplication.Views.Settings.SettingsPageView"
             x:DataType="vm:SettingsPageViewModel">
  <Design.DataContext>
    <x:Static Member="vm:SettingsPageViewModel.Design"/>
  </Design.DataContext>

  <overlays:OverlayPanel IsOverlayVisible="{Binding IsOverlayVisible}">
    <ScrollViewer Name="PART_ScrollViewer">

      <StackPanel Margin="20">
        <common:AppButton Margin="0 0 0 10"
                          Text="Restore Default Settings"
                          IconStart="{StaticResource IconArrowRotateRight}"
                          HorizontalAlignment="Right"
                          Click="RestoreDefaultSettingsButton_Click"/>

        <local:SettingsSectionShell HeaderText="Encryption Key" HeaderIcon="{StaticResource IconKey}">
          <local:EncryptionKeyFileView DataContext="{Binding EncryptionKeyFileVM}"
                                       HorizontalAlignment="Left"
                                       RemoveKeyReferenceClicked="EncryptionKeyFileView_RemoveKeyReferenceClicked"/>
        </local:SettingsSectionShell>

        <local:SettingsSectionShell HeaderText="Theming" HeaderIcon="{StaticResource IconPalette}">
          <StackPanel Spacing="20">

            <StackPanel Spacing="10">
              <Label>Theme Color</Label>

              <ListBox ItemsSource="{Binding ThemeDefinitions}"
                       SelectedItem="{Binding CurrentThemeDefinition}"
                       HorizontalAlignment="Left"
                       CornerRadius="8"
                       Cursor="Hand">
                <ListBox.ItemsPanel>
                  <ItemsPanelTemplate>
                    <StackPanel Orientation="Horizontal" Margin="10"/>
                  </ItemsPanelTemplate>
                </ListBox.ItemsPanel>

                <ListBox.ItemTemplate>
                  <DataTemplate>
                    <StackPanel x:DataType="models:AppThemeDefinition">
                      <Border Width="100" Height="75" CornerRadius="4" Background="{Binding BackgroundBrush}">
                        <Border Margin="10 10 10 20" CornerRadius="4" Background="{Binding ForegroundBrush}">
                          <StackPanel>
                            <Border Margin="10 10 0 0" Width="50" Height="4" CornerRadius="4" Background="{Binding BackgroundBrush}" HorizontalAlignment="Left"/>
                            <Border Margin="10 3 0 0" Width="33" Height="4" CornerRadius="4" Background="{Binding BackgroundBrush}" HorizontalAlignment="Left"/>
                            <Border Margin="10 3 0 0" Width="25" Height="4" CornerRadius="4" Background="{Binding BackgroundBrush}" HorizontalAlignment="Left"/>
                          </StackPanel>
                        </Border>
                      </Border>
                      <TextBlock Margin="0 10 0 0" FontWeight="SemiBold" Text="{Binding ThemeName}"/>
                    </StackPanel>
                  </DataTemplate>
                </ListBox.ItemTemplate>

              </ListBox>
            </StackPanel>

            <StackPanel Margin="0 10 0 0">
              <Label Target="PART_FontSizeInput">Font Size</Label>
              <NumericUpDown Name="PART_FontSizeInput"
                             Value="{Binding FontSize}"
                             VerticalContentAlignment="Center"
                             Minimum="1"
                             Maximum="100"
                             FormatString="0"/>
            </StackPanel>

          </StackPanel>
        </local:SettingsSectionShell>

        <local:SettingsSectionShell HeaderText="Backup And Restore" HeaderIcon="{StaticResource IconArrowsRotate}">
          <StackPanel Spacing="20">

            <StackPanel>
              <Label Target="PART_BackupDirectoryInput">Backup Directory</Label>
              <TextBox Name="PART_BackupDirectoryInput"
                       Text="{Binding BackupDirectory}"
                       VerticalContentAlignment="Center">
                <TextBox.InnerRightContent>
                  <common:AppButton IconStart="{StaticResource IconFolder}"
                                    Click="SelectDirectoryButton_Click"
                                    ToolTip.Tip="Select Directory" />
                </TextBox.InnerRightContent>
              </TextBox>
              <TextBlock Margin="0 4 0 0"
                         FontWeight="SemiBold"
                         Foreground="{Binding BackupDirectoryProps.MessageBrush}"
                         Text="{Binding BackupDirectoryProps.MessageText}"/>
            </StackPanel>

            <StackPanel>
              <Label Target="PART_MaxBackupsInput">Max Backups</Label>
              <NumericUpDown Name="PART_MaxBackupsInput"
                             Value="{Binding MaxBackups}"
                             VerticalContentAlignment="Center"
                             Minimum="1"
                             Maximum="100"
                             FormatString="0"/>
            </StackPanel>

            <Grid RowDefinitions="Auto" ColumnDefinitions="Auto, *">
              <CheckBox Name="PART_AutoBackupCheckBox" IsChecked="{Binding AutoBackupOnLogout}" Grid.Column="0"/>
              <Label Target="PART_AutoBackupCheckBox" VerticalAlignment="Center" Grid.Column="1">
                <TextBlock TextWrapping="Wrap" MaxLines="4">Automatically create backup on logout.</TextBlock>
              </Label>
            </Grid>

            <StackPanel Orientation="Horizontal" Spacing="10">
              <common:AppButton Text="Backup Now"
                                IconStart="{StaticResource IconDownload}"
                                IsEnabled="{Binding BackupDirectoryProps.IsValid}"
                                Click="BackupNowButton_Click"/>

              <common:AppButton Text="Load Backup"
                                IconStart="{StaticResource IconUpload}"
                                Click="LoadBackupButton_Click" />
            </StackPanel>

          </StackPanel>
        </local:SettingsSectionShell>

        <local:SettingsSectionShell HeaderText="Group Settings" HeaderIcon="{StaticResource IconList}">
          <Grid RowDefinitions="Auto" ColumnDefinitions="*, *" ColumnSpacing="10">
            <StackPanel Grid.Column="0">
              <TextBlock Classes="h4">Empty Group Mode</TextBlock>
              <TextBlock TextWrapping="Wrap">When all Keys have been taken out of a Group, what should happen to the empty Group?</TextBlock>
            </StackPanel>

            <ListBox ItemsSource="{Binding EmptyGroupModeDefinitions}"
                     SelectedItem="{Binding CurrentEmptyGroupModeDefinition}"
                     CornerRadius="8"
                     Cursor="Hand"
                     Grid.Column="1">
              <ListBox.ItemTemplate>
                <DataTemplate x:DataType="settings:EmptyGroupModeDefinition">
                  <StackPanel Spacing="10">
                    <TextBlock Text="{Binding Name}" Classes="h4" Margin="0"/>
                    <TextBlock Text="{Binding Description}"/>
                  </StackPanel>
                </DataTemplate>
              </ListBox.ItemTemplate>
            </ListBox>
          </Grid>
        </local:SettingsSectionShell>

        <local:SettingsSectionShell HeaderText="Default Key Generation Settings" HeaderIcon="{StaticResource IconVault}">
          <local:KeyGenerationSettingsView DataContext="{Binding KeyGenerationSettingsVM}" />
        </local:SettingsSectionShell>

      </StackPanel>

    </ScrollViewer>

    <overlays:OverlayPanel.OverlayContent>
      <overlays:Modal Content="{Binding OverlayContent}">
      </overlays:Modal>
    </overlays:OverlayPanel.OverlayContent>
  </overlays:OverlayPanel>
</UserControl>
